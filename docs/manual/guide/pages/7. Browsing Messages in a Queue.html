<html>
     <head>
     	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
     	<title>7. Browsing Messages in a Queue</title>
     	<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8">
     </head>
	<body class="body">
		If you are looking on ways to obtain the contents of a given <code> javax.jms.Queue </code> without changing its state the
<code> JmsService </code> offers a set of methods designed for this task.<p class="paragraph"/><h4>The browse(destination, jmsTemplateName, browserCallback) method.</h4>
Will retrieve all messages inside the given <em class="italic">queue</em> at that time without changing its state i.e messages will not be consumed.
This method will convert the <code> javax.jms.Message </code> using the <code> JmsTemplate </code>. If you need the  <code> javax.jms.Message </code>
you should use the <code> browseNoConvert() </code> method and its variants as described further on.<p class="paragraph"/>
<strong class="bold">destination</strong><p class="paragraph"/>An instance of <code> javax.jms.Queue </code> , a <code> String </code> or a <code> Map </code> . <strong class="bold">Needs</strong> to be a <em class="italic">queue</em> .<p class="paragraph"/>A <code> String </code> destination argument will be interpreted as the name of a destination <em class="italic">queue</em> .<p class="paragraph"/>A <code> Map </code> destination argument can be used in the following ways:<p class="paragraph"/><div class="code"><pre>// browse literal queue
List messages = jmsService.browse(queue: <span class="java&#45;quote">"aQueue"</span>, <span class="java&#45;quote">"standard"</span>, <span class="java&#45;keyword">null</span>)<p class="paragraph"/>// browse the queue '«appname».person'
List messages = jmsService.browse(service: <span class="java&#45;quote">"person"</span>, <span class="java&#45;quote">"standard"</span>, <span class="java&#45;keyword">null</span>)<p class="paragraph"/>// browse the queue '«appname».person.doIt'
List messages = jmsService.browse(service: <span class="java&#45;quote">"person"</span>, method: <span class="java&#45;quote">"doIt"</span>, <span class="java&#45;quote">"standard"</span>, <span class="java&#45;keyword">null</span>)<p class="paragraph"/>// browse the queue 'remote.person.doIt'
List messages = jmsService.browse(app: <span class="java&#45;quote">"remote"</span>, service: <span class="java&#45;quote">"person"</span>, method: <span class="java&#45;quote">"doIt"</span>, <span class="java&#45;quote">"standard"</span>, <span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/>
<strong class="bold">jmsTemplateName</strong><p class="paragraph"/>The name of the template that should be used to send the message. If this value is <code> null </code> , the standard template will be used (called "standard").<p class="paragraph"/><strong class="bold">browserCallback</strong><p class="paragraph"/>An optional closure that can be used to "process" the message before being added to the returning message list. The value returned by this <strong class="bold">callback</strong> will
be the one added to the returning list if such value is <strong class="bold">not null</strong>.<p class="paragraph"/><h4>browse() method variants</h4><p class="paragraph"/>There are variations of the browse() method for convenience...<p class="paragraph"/><div class="code"><pre>List messages = jmsService.browse(queue)<p class="paragraph"/>List messages = jmsService.browse(queue, browserCallback)<p class="paragraph"/>List messages = jmsService.browse(queue, jmsTemplateBeanName)</pre></div><p class="paragraph"/>
<h4>The browseNoConvert(destination, jmsTemplateName, browserCallback) method.</h4>
This method will not convert the <code> javax.jms.Message </code>. In other words the <code> browserCallback:Closure </code> will receive a
 <code> javax.jms.Message </code> or if no <em class="italic">callback</em> is defined a <em class="italic">list</em> containing <code> javax.jms.Message </code> instances will be returned.
 <strong class="bold">You can't</strong> update the returned <code> javax.jms.Message </code> objects, they are <strong class="bold">read-only</strong> instances.<p class="paragraph"/><div class="code"><pre>List messages = jmsService.browseNoConvert(queue)<p class="paragraph"/>//You can <span class="java&#45;keyword">do</span> the following to filter messages or use a selector through the browseSelected&#42; methods
List messages = jmsService.browseNoConvert(queue)&#123; javax.jms.Message msg &#45;&#62;
    ( msg.getStringProperty('aproperty') ? msg : <span class="java&#45;keyword">null</span> ) 
&#125;<p class="paragraph"/>List messages = jmsService.browseNoConvert(queue, jmsTemplateBeanName)
messages.each &#123;
    assert it <span class="java&#45;keyword">instanceof</span> javax.jms.Message
&#125;</pre></div><p class="paragraph"/><h4>The browseSelected(destination, selector, jmsTemplateName, browserCallback) method.</h4>
Will retrieve messages that match the <strong class="bold">selector</strong> inside the given <em class="italic">queue</em> at the time of the call without changing its state i.e messages will not be consumed.
This method will convert the <code> javax.jms.Message </code> using the <code> JmsTemplate </code>. If you need the  <code> javax.jms.Message </code>
you should use the <code> browseSelectedNotConvert() </code> method and its variants as described further on.<p class="paragraph"/><strong class="bold">selector</strong><p class="paragraph"/>This is the message selector as described by the JMS Specification. In a nutshell a <strong class="bold">message selector</strong> lets a client
specify a statement, which is similar to an SQL92 statement, that will be used to filter messages through the values
of their <strong class="bold">message headers</strong> and <strong class="bold">message properties</strong>.
"Only messages whose header and property values match the selector are delivered". As described in the <strong class="bold">JMS</strong>
Specification what it means for a message not to be delivered depends on the MessageConsumer being used.
It is important to mention that the selectors can only access <strong class="bold">header</strong> or <strong class="bold">properties</strong> but will <strong class="bold">not be able to access any message body values</strong>.<p class="paragraph"/><div class="code"><pre>List messages = jmsService.browseSelected(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>)<p class="paragraph"/>//filtering through body content.
List messages = jmsService.browseSelected(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>)&#123;
    ( msg == 'avalue' ?: <span class="java&#45;keyword">null</span> )
&#125;<p class="paragraph"/>List messages = jmsService.browseSelected(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>, jmsTemplateBeanName)</pre></div><p class="paragraph"/>
<h4>The browseSelectedNotConvert(destination, selector, jmsTemplateName, browserCallback) method.</h4>
Will retrieve messages that match the <strong class="bold">selector</strong> inside the given <em class="italic">queue</em> at the time of the call without changing its state i.e messages will not be consumed.
As the <code> browseNoConvert </code> this method will not convert the <code> javax.jms.Message </code>.<p class="paragraph"/><div class="code"><pre>List messages = jmsService.browseSelectedNotConvert(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>)<p class="paragraph"/>List messages = jmsService.browseSelectedNotConvert(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>)&#123; javax.jms.Message msg &#45;&#62;
    <span class="java&#45;keyword">return</span> msg.JMSCorrelationID
&#125;<p class="paragraph"/>List messages = jmsService.browseSelectedNotConvert(queue, <span class="java&#45;quote">" anIntProperty &#62; 0 AND anotherProperty='a Value'"</span>, jmsTemplateBeanName)
messages.each &#123;
    assert it <span class="java&#45;keyword">instanceof</span> javax.jms.Message
&#125;</pre></div>
	</body>
</html>